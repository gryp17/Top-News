var app=angular.module("top-news",["ngRoute","ngSanitize","ngAnimate"]);app.config(["$routeProvider",function($routeProvider){$routeProvider.when("/articles/:section_name",{templateUrl:"app/views/partials/articles.php"}).when("/archive",{templateUrl:"app/views/partials/archive.php"}).when("/article/:id",{templateUrl:"app/views/partials/article.php"}).when("/signup",{templateUrl:"app/views/partials/signup.php"}).otherwise({templateUrl:"app/views/partials/home.php"})}]),app.service("APIservice",function($http,$rootScope){this.getArticles=function(category,limit,offset){return"number"!=typeof limit&&(limit=6),"number"!=typeof offset&&(offset=0),$http({method:"POST",url:"API/getArticles",data:{category:category,limit:limit,offset:offset}})},this.getArticlesBySearch=function(category,search_val){return $http({method:"POST",url:"API/getArticlesBySearch",data:{category:category,search_val:search_val}})},this.getArticlesByDate=function(date){return $http({method:"POST",url:"API/getArticlesByDate",data:{date:date}})},this.getLatestArticleDate=function(category){return $http({method:"POST",url:"API/getLatestArticleDate",data:{category:category}})},this.getArticle=function(id){return $http({method:"POST",url:"API/getArticle",data:{id:id}})},this.addArticleView=function(id){return $http({method:"POST",url:"API/addArticleView",data:{id:id}})}}),app.service("searchService",function($rootScope){$rootScope.search_data={search_val:""},this.getSearchVal=function(){return $rootScope.search_data.search_val},this.setSearchVal=function(search_val){$rootScope.search_data.search_val=search_val}}),app.filter("limitText",function(){return function(text,max_length,add_dots){return"undefined"==typeof max_length&&(max_length=100),"undefined"==typeof add_dots&&(add_dots=!0),text.length>max_length&&(text=text.substring(0,max_length),add_dots===!0&&(text+="...")),text}}),app.filter("formatDate",function($filter){return function(text,format){return text=text.split("-").join("/"),text=$filter("date")(new Date(text),format)}}),app.directive("currencyExchangeBar",function($timeout){return{restrict:"C",replace:!0,templateUrl:"app/views/directives/currency_exchange_bar.php",link:function(scope,element,attr){$timeout(function(){var iframe=element.find("iframe"),source=iframe.attr("src"),currencyWidth=element.width();currencyWidth-=2,source=source.replace(".php?w=700",".php?w="+currencyWidth),iframe.attr("src",source).delay(350).fadeIn(500)},500)}}}),app.directive("errorPopup",function(){return{restrict:"C",link:function(scope,element,attr){var input=element.siblings('input[type="text"]');input.popover({placement:"top",content:attr.content,trigger:"manual"}),scope.$watch(function(){return scope.$eval(attr.show)},function(newValue,oldValue){newValue===!0?(input.data("bs.popover").options.content=attr.content,input.addClass("input-error"),input.on("focus",function(){input.addClass("input-error")}),input.popover("show")):(input.removeClass("input-error"),input.off("focus"),input.popover("hide"))})}}}),app.directive("mainMenu",function(){return{restrict:"C",link:function(scope,element,attr){element.find("#hamburger-button").click(function(){$("#menu-options").slideToggle()}),element.find("#menu-options a").click(function(){element.find("#hamburger-button").is(":visible")&&$("#menu-options").slideUp()})}}}),app.directive("scrollTop",function(){return{restrict:"C",replace:!0,templateUrl:"app/views/directives/scroll_top.php",link:function(scope,element,attr){scope.$watch(function(){return $(document).height()},function(newValue,oldValue){newValue!=oldValue&&$(document).width()>=768&&$(window).scroll(function(){var height=$(window).height(),top=$(this).scrollTop();top>=height+height/2?element.fadeIn():element.fadeOut()})}),element.click(function(){$("html, body").animate({scrollTop:0},1e3)})}}}),app.controller("archiveController",function($rootScope,$scope,$routeParams,searchService,APIservice){searchService.setSearchVal(""),$scope.selected_date,$("#archive-date-picker").datepicker({constrainInput:!0,dateFormat:"yy-mm-dd"}),$("#archive-date-picker").siblings(".input-group-btn").click(function(){$("#archive-date-picker").focus()});var response=APIservice.getLatestArticleDate();response.success(function(result,status,headers,config){1===result.status?$("#archive-date-picker").datepicker("option","maxDate",new Date(result.data)):console.log(result.error)}),$scope.$watch("selected_date",function(){if("undefined"!=typeof $scope.selected_date){var response=APIservice.getArticlesByDate($scope.selected_date);response.success(function(result,status,headers,config){1===result.status?($rootScope.articles_data=result.data,console.log($rootScope.articles_data),$("#loading-wrapper").fadeOut(200,function(){$("#articles-wrapper").fadeIn(500)})):console.log(result.error)})}});var response=APIservice.getArticles();response.success(function(result,status,headers,config){1===result.status?($rootScope.articles_data=result.data,$("#loading-wrapper").fadeOut(200,function(){$("#articles-wrapper").fadeIn(500)})):console.log(result.error)}),$scope.limit=6,$scope.offset=0,$scope.loading=!1,$(window).unbind("scroll"),$(window).scroll(function(){var search_val=searchService.getSearchVal();if(search_val.length>=3||"undefined"!=typeof $scope.selected_date)return!1;var scrollTop=$(window).scrollTop()+500,footerPosition=$("footer").offset().top-400;if(scrollTop>footerPosition&&0==$scope.loading){$scope.offset=$scope.offset+6,$scope.loading=!0;var response=APIservice.getArticles(null,$scope.limit,$scope.offset);response.success(function(result,status,headers,config){if($scope.loading=!1,1===result.status)for(var i=0;i<result.data.length;i++)$rootScope.articles_data.push(result.data[i]);else console.log(result.error)})}})}),app.controller("articleController",function($rootScope,$scope,$routeParams,searchService,APIservice){$scope.section_name=$routeParams.section_name,$scope.article_id=$routeParams.id,searchService.setSearchVal("");var response=APIservice.getArticle($scope.article_id);response.success(function(result,status,headers,config){1===result.status?($scope.article=result.data,console.log($scope.article),$("#loading-wrapper").fadeOut(200,function(){$("#article-wrapper").fadeIn(500)})):console.log(result.error)}),APIservice.addArticleView($scope.article_id)}),app.controller("articlesController",function($rootScope,$scope,$routeParams,$http,searchService,APIservice){$scope.section_name=$routeParams.section_name,searchService.setSearchVal("");var response=APIservice.getArticles($scope.section_name);response.success(function(result,status,headers,config){1===result.status?($rootScope.articles_data=result.data,$("#loading-wrapper").fadeOut(200,function(){$("#articles-wrapper").fadeIn(500)})):console.log(result.error)}),$scope.limit=6,$scope.offset=0,$scope.loading=!1,$(window).unbind("scroll"),$(window).scroll(function(){var search_val=searchService.getSearchVal();if(search_val.length>=3)return!1;var scrollTop=$(window).scrollTop()+500,footerPosition=$("footer").offset().top-400;if(scrollTop>footerPosition&&0==$scope.loading){$scope.offset=$scope.offset+6,$scope.loading=!0;var response=APIservice.getArticles($scope.section_name,$scope.limit,$scope.offset);response.success(function(result,status,headers,config){if($scope.loading=!1,1===result.status)for(var i=0;i<result.data.length;i++)$rootScope.articles_data.push(result.data[i]);else console.log(result.error)})}})}),app.controller("homeController",function($rootScope,$scope,$routeParams,searchService,APIservice){searchService.setSearchVal(""),$(window).unbind("scroll");var response=APIservice.getArticles();response.success(function(result,status,headers,config){1===result.status?($rootScope.articles_data=result.data,$("#loading-wrapper").fadeOut(200,function(){$("#articles-wrapper").fadeIn(500)})):console.log(result.error)})}),app.controller("searchController",function($rootScope,$scope,$routeParams,$http,searchService,APIservice){$scope.section_name="all news",$rootScope.$on("$routeChangeSuccess",function(){"undefined"!=typeof $routeParams.section_name?$scope.section_name=$routeParams.section_name:$scope.section_name="all news"}),$scope.timer,$scope.search=function(){$scope.timer&&window.clearTimeout($scope.timer),$scope.timer=window.setTimeout(function(){$scope.timer=null;var search_val=searchService.getSearchVal();if(0===search_val.length||search_val.length>=3){var response;response=0===search_val.length?APIservice.getArticles($scope.section_name,null,null):APIservice.getArticlesBySearch($scope.section_name,search_val),response.success(function(result,status,headers,config){1==result.status&&result.data.length>0?($("#archive-link, .article-box").fadeIn(1),$("#not-found").fadeOut(1)):($("#not-found").fadeIn(500),$(".article-box, #archive-link").fadeOut(1)),$rootScope.articles_data=result.data})}},1e3)}}),app.controller("signupController",function($rootScope,$scope,$routeParams,$timeout,searchService,APIservice){searchService.setSearchVal(""),$scope.test="sign up page"});